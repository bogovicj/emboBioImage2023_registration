% the various libraries we will be using
\usepackage{tikz}
\usetikzlibrary{calc}
\usepackage[none]{hyphenat}
\usepackage{times}
\usepackage{amsmath}
\usepackage[overlay,absolute]{textpos}
%\usepackage{fontspec}
%\defaultfontfeatures{Ligatures=TeX}

% define colours
% taken from pickton on Adobe Kuler:
% https://kuler.adobe.com/Some-Kind-Of-Execushares-color-theme-3837185/
\definecolor{HHMIBlue}{RGB}{5,141,150}
\definecolor{HHMIBlack}{RGB}{0,0,0}
\definecolor{HHMIGreenA}{RGB}{138,195,65}
\definecolor{HHMIGreenB}{RGB}{45,169,72}
\definecolor{HHMIWhite}{RGB}{255,255,255}
\definecolor{HHMIGrayA}{RGB}{131,130,134}
\definecolor{HHMIGrayB}{RGB}{170,170,170}
\definecolor{HHMIGrayC}{RGB}{220,220,220}
\definecolor{HHMIYellow}{RGB}{238,220,17}
\definecolor{HHMIOrange}{RGB}{221,130,53}



% use Adobe's Source Pro fonts:
% Source Serif Pro: http://store1.adobe.com/cfusion/store/html/index.cfm?store=OLS-US&event=displayFontPackage&code=1966
% Source Sans Pro: http://store1.adobe.com/cfusion/store/html/index.cfm?event=displayFontPackage&code=1959
% Source Code Pro: http://store1.adobe.com/cfusion/store/html/index.cfm?store=OLS-US&event=displayFontPackage&code=1960
%\setmainfont{Source Serif Pro}
%\setsansfont{Source Sans Pro}
%\setmonofont{Source Code Pro}

% To use with pdflatex,
% comment the fontspec package at the top
%\usepackage{sourceserifpro}
%\usepackage{sourcesanspro}
%\usepackage{sourcecodepro}

\setbeamertemplate{bibliography item}{\insertbiblabel}

% set colours
\setbeamertemplate{enumerate items}[default]
\setbeamertemplate{enumerate items}[default]
\setbeamertemplate{itemize items}[default]

\def\whiteframe{
\setbeamercolor{itemize item}{fg=HHMIBlack}
\setbeamercolor{itemize subitem}{fg=HHMIBlack}
\setbeamercolor{enumerate item}{fg=HHMIBlack}
\setbeamercolor{enumerate subitem}{fg=HHMIBlack}
\setbeamercolor{alerted text}{fg=HHMIGreenB}
\setbeamercolor{section in toc}{fg=HHMIBlack}
\setbeamercolor{description item}{fg=black}
\setbeamercolor{normal text}{bg=,fg=black}
\setbeamercolor{bibliography item}{fg=green}
\setbeamercolor{bibliography entry author}{fg=HHMIBlack}
\setbeamercolor{bibliography entry title}{fg=HHMIBlack}
\setbeamercolor{bibliography entry location}{fg=HHMIBlack}
\setbeamercolor{bibliography entry note}{fg=HHMIBlack}
\setbeamercolor{bibliography item}{fg=HHMIBlack}
\usebeamercolor[fg]{normal text}
}

\def\blackframe{
\setbeamercolor{itemize item}{fg=HHMIGrayA}
\setbeamercolor{itemize subitem}{fg=HHMIGrayA}
\setbeamercolor{enumerate item}{fg=HHMIGrayA}
\setbeamercolor{enumerate subitem}{fg=HHMIGrayA}
\setbeamercolor{alerted text}{fg=HHMIGreenB}
\setbeamercolor{section in toc}{fg=HHMIGrayA}
\setbeamercolor{description item}{fg=HHMIGrayA}
\setbeamercolor{normal text}{bg=black,fg=white}
\setbeamercolor{bibliography item}{fg=green}
\setbeamercolor{bibliography entry author}{fg=HHMIGrayA}
\setbeamercolor{bibliography entry title}{fg=HHMIGrayA}
\setbeamercolor{bibliography entry location}{fg=HHMIGrayA}
\setbeamercolor{bibliography entry note}{fg=HHMIGrayA}
\setbeamercolor{bibliography item}{fg=HHMIGrayA}
\usebeamercolor[fg]{normal text}
}

\whiteframe

%\setbeamertemplate{itemize item}{$\blacktriangleright$}
%\setbeamertemplate{itemize subitem}{$\blacktriangleright$}
    
% set fonts
%\setbeamerfont{itemize/enumerate body}{size=\large}
%\setbeamerfont{itemize/enumerate subbody}{size=\normalsize}
%\setbeamerfont{itemize/enumerate subsubbody}{size=\small}

% make the itemize bullets pixelated >
% \setbeamertemplate{itemize item}{
% 	\tikz{
% 		\draw[fill=HHMIGreenA,draw=none] (0, 0) rectangle(0.1, 0.1);
% 		\draw[fill=HHMIGreenA,draw=none] (0.1, 0.1) rectangle(0.2, 0.2);
% 		\draw[fill=HHMIGreenA,draw=none] (0, 0.2) rectangle(0.1, 0.3);
% 	}
% }
% % make the subitems also pixelated >, but a little smaller and red
% \setbeamertemplate{itemize subitem}{
% 	\tikz{
% 		\draw[fill=HHMIBlue,draw=none] (0, 0) rectangle(0.075, 0.075);
% 		\draw[fill=HHMIBlue,draw=none] (0.075, 0.075) rectangle(0.15, 0.15);
% 		\draw[fill=HHMIBlue,draw=none] (0, 0.15) rectangle(0.075, 0.225);
% 	}
% }

% disable navigation
\setbeamertemplate{navigation symbols}{}

% custom draw the title page above
\setbeamertemplate{title page}{}

% again, manually draw the frame title above
\setbeamertemplate{frametitle}{}

% disable "Figure:" in the captions
\setbeamertemplate{caption}{\tiny\insertcaption}
\setbeamertemplate{caption label separator}{}

% since I don't know a better way to do this, these are all switches
% doing `\setcounter{showProgressBar}{0}` will turn the progress bar off (I turn it off for Appendix slides)
% etc
\newcounter{showProgressBar}
\setcounter{showProgressBar}{1}
\newcounter{showSlideNumbers}
\setcounter{showSlideNumbers}{1}
\newcounter{showSlideTotal}
\setcounter{showSlideTotal}{1}
\newcounter{showSectionTitle}
\setcounter{showSectionTitle}{1}
\newcounter{showShortTitle}
\setcounter{showShortTitle}{0}

% use \makeatletter for our progress bar definitions
% progress bar idea from http://tex.stackexchange.com/a/59749/44221
% slightly adapted for visual purposes here
\makeatletter
\newcount\progressbar@tmpcounta% auxiliary counter
\newcount\progressbar@tmpcountb% auxiliary counter
\newdimen\progressbar@pbwidth %progressbar width
\newdimen\progressbar@tmpdim % auxiliary dimension

\newdimen\slidewidth % auxiliary dimension
\newdimen\slideheight % auxiliary dimension

% make the progress bar go across the screen
%\progressbar@pbwidth=12.8cm
\progressbar@pbwidth=\the\paperwidth
\slidewidth=\the\paperwidth
\slideheight=\the\paperheight

% use tikz to draw everything
% it may not be the best, but it's easy to work with
% and looks good
% TODO: base title slide and contents slide on something other than slide numbers :/
\setbeamertemplate{background}{
	% deal with progress bar stuff
	% (calculate where it should go)
	\progressbar@tmpcounta=\insertframenumber
	\progressbar@tmpcountb=\inserttotalframenumber
	\progressbar@tmpdim=\progressbar@pbwidth
	\divide\progressbar@tmpdim by 100
	\multiply\progressbar@tmpdim by \progressbar@tmpcounta
	\divide\progressbar@tmpdim by \progressbar@tmpcountb
	\multiply\progressbar@tmpdim by 100
	
	\begin{tikzpicture}
		% set up the entire slide as the canvas
		\useasboundingbox (0,0) rectangle(\the\paperwidth,\the\paperheight);

		% the background
		%\fill[color=HHMIWhite] (0,0) rectangle(\the\paperwidth,\the\paperheight);

		% separate the drawing based on if we're the first (title) slide or not
		\ifnum\thepage=1\relax
			% the title page
			% draw the fills
			%\shade[left color=HHMIBlue,right color=HHMIGreenA] (0, 0) rectangle(\the\paperwidth,\the\paperheight);
            \node[at=(current page.center)]{\includegraphics[keepaspectratio,width=\paperwidth,height=\paperheight]{bwTitle.png}};
			\node[anchor=north,text width=\slidewidth-1cm,inner xsep=0.5cm] at (0.5\slidewidth+1pt,\paperheight-0.25cm) {\includegraphics[width=3.8cm]{janelia-logo-whitewhite.pdf}};
			
			% draw the actual text
			\node[anchor=south,text width=\slidewidth-1cm,inner xsep=0.5cm] at (0.5\slidewidth+1pt,5.25cm) {\color{HHMIWhite}\large\insertauthor};
			\node[anchor=north,text width=\slidewidth-1cm,inner xsep=0.5cm] at (0.5\slidewidth,5.25cm) {\color{HHMIWhite}\huge\textbf{\inserttitle}};
			\node[anchor=south west] at (0.5cm,0cm) {\color{HHMIWhite}\tiny\insertsubtitle};
			
			% add the date in the corner
			\node[anchor=south east] at(\slidewidth-0.25cm,0cm) {\color{HHMIWhite}\footnotesize\insertdate};
            \node[anchor=south west] at(0.25cm,0cm) {\color{HHMIWhite}\footnotesize EMBO Course 2023};
		\else
			% NOT the title page
			% title bar
			\ifx\insertframetitle\empty
				% it is empty
			\else
				it is not
				\fill[color=HHMIGreenB] (0, \slideheight-1cm) rectangle(\slidewidth,\slideheight);

				% swap the comment on these to add section titles to slide titles
				%\node[anchor=north,text width=11.8cm,inner xsep=0.5cm,inner ysep=0.25cm] at (6.4cm,9.6cm) {\color{HHMIWhite}\Large\textbf{\insertsectionhead: \insertframetitle}};
				\node[anchor=north,text width=\slidewidth-1cm,inner xsep=0.5cm,inner ysep=0.25cm] at (0.5\slidewidth,\slideheight) {\color{HHMIWhite}\LARGE\textbf{\insertframetitle}};
			\fi
			
			% if we're showing a progress bar, show it
			% (I disable the progress bar and slide numbers for the "Appendix" slides)
			\ifnum \value{showProgressBar}>0\relax%
				% the the progress bar icon in the middle of the screen
				\draw[fill=HHMIGrayC,draw=none] (0cm,0cm) rectangle(\slidewidth,0.25cm);
				\draw[fill=HHMIGreenB,draw=none] (0cm,0cm) rectangle(\progressbar@tmpdim,0.25cm);

				% bottom information
				\node[anchor=south west] at(0cm,0.25cm) {\color{HHMIGrayB}\tiny\insertsection{} %
				\ifx\insertsubsection\empty
					%it is empty
				\else
					~| \insertsubsection%
				\fi%
				};

				\ifnum \value{showShortTitle}>0\relax%
                    \node[anchor=south] at(0.5\slidewidth,0.25cm) {\color{HHMIGrayB}\tiny \insertshorttitle};
                \fi

				% if slide numbers are active
				\ifnum \value{showSlideNumbers}>0\relax%
					% if slide totals are active
					\ifnum \value{showSlideTotal}>0\relax%
						% draw both slide number and slide total
						\node[anchor=south east] at(\slidewidth,0.25cm) {\color{HHMIGrayB}\tiny\insertframenumber/\inserttotalframenumber};
					\else
						% slide totals aren't active, don't draw them
						\node[anchor=south east] at(\slidewidth,0.25cm) {\color{HHMIGrayB}\tiny\insertframenumber};
					\fi
				\fi
			% don't show the progress bar?
			\else
				\ifnum \value{showSectionTitle}>0\relax%
					% section title in the bottom left
					\node[anchor=south west] at(0cm,0cm) {\color{HHMIGrayB}\tiny\insertsection %
					%\node[anchor=south west] at(0cm,0cm) {\color{HHMIGrayB}\tiny HEYHEY%
					\ifx\insertsubsection\empty
						%it is empty
					\else
						~| \insertsubsection%
					\fi%
					};
				\fi

                % If we're showing the short title
				\ifnum \value{showShortTitle}>0\relax%
                    \node[anchor=south] at(0.5\slidewidth,0.25cm) {\color{HHMIGrayB}\tiny \insertshorttitle};
                \fi

				% if we're showing slide numbers
				\ifnum \value{showSlideNumbers}>0\relax%
					% if slide totals are active
					\ifnum \value{showSlideTotal}>0\relax%
						% draw both slide number and slide total
						\node[anchor=south east] at(\slidewidth,0cm) {\color{HHMIGrayB}\tiny\insertframenumber/\inserttotalframenumber};
					\else
						% slide totals aren't active, don't draw them
						\node[anchor=south east] at(\slidewidth,0cm) {\color{HHMIGrayB}\tiny\insertframenumber};
					\fi
				\fi
			\fi
		\fi
	\end{tikzpicture}
}
\makeatother

% add section titles
% \AtBeginSection{\frame{\sectionpage}}
\setbeamertemplate{section page}
{
	\begin{tikzpicture}
		% set up the entire slide as the canvas
		\useasboundingbox (0,0) rectangle(\the\paperwidth,\the\paperheight);
		%\fill[color=HHMIWhite] (0,0) rectangle(\the\paperwidth,\the\paperheight);
		%\fill[color=HHMIWhite] (-1cm, 2cm) rectangle (\slidewidth, \slideheight+0.1cm);
		\fill[color=HHMIBlue] (-1cm, 0cm) rectangle(\the\paperwidth,\the\paperheight+0.1cm);
		\node[anchor=north west,text width=\slidewidth] at (-0.5cm,6cm) {\color{HHMIWhite}\Huge{\insertsection}};
		\node[text width=\the\paperwidth-1cm,align=center] at (0.4\slidewidth, 0.5\slideheight) {\color{HHMIWhite}\Huge\textbf{\insertsection}};
	\end{tikzpicture}
}
